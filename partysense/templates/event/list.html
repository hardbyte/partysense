{% extends "base.html" %}
{% load humanize %}
{% load url from future %}

{% block style %}
#map-canvas {
    margin: 0;
    padding: 0;
    height: 400px;
}
{% endblock %}

{% block content %}
    <p>todo</p>

    <div id="map-canvas"></div>



{% endblock %}

{% block jslibs %}

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjOEItJV2ny3PQzAB6jeoQztOHvqBnQ_I&sensor=true"></script>
    <script>
        /* Map the gigs. */

        var map, geocoder;
        function initialize() {
            geocoder = new google.maps.Geocoder();
            var mapDiv = document.getElementById('map-canvas');

            /* Center the map on user's address. */
            geocoder.geocode( { 'address': "Bush Inn, Riccarton"}, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    console.log(results[0].geometry);

                    map = new google.maps.Map(mapDiv, {
                        //center: new google.maps.LatLng(37.4419, -122.1419),
                        center: results[0].geometry.location,
                        zoom: 14,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    });

                    google.maps.event.addListenerOnce(map, 'tilesloaded', addMarkers);

                    var marker = new google.maps.Marker({
                        map: map,
                        position: results[0].geometry.location
                    });
                } else {
                    alert("Geocode was not successful for the following reason: " + status);
                }
            });
        }

        function addMarkers() {
            // Just add 10 random markers for now...
            var bounds = map.getBounds();
            var southWest = bounds.getSouthWest();
            var northEast = bounds.getNorthEast();
            var lngSpan = northEast.lng() - southWest.lng();
            var latSpan = northEast.lat() - southWest.lat();
            for (var i = 0; i < 10; i++) {
                var latLng = new google.maps.LatLng(southWest.lat() + latSpan * Math.random(),
                        southWest.lng() + lngSpan * Math.random());
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: map
                });
            }
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>

{% endblock %}